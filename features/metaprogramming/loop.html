<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Loops | .NEXT </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Loops | .NEXT ">
    <meta name="generator" content="docfx 2.40.7.0">
    
    <link rel="shortcut icon" href="../../fav.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../doc_logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="loops">Loops</h1>

<p>Metaprogramming library provides construction of <code>for</code>, <code>foreach</code> and <code>while</code> loops. The scope object available inside of builder block of code provides two special parameterless methods for continuation and abortion of loop execution: <code>Continue()</code> and <code>Break()</code>. The same methods are available from any other scope object with one exception: these methods have single parameter receiving scope object of the loop to be aborted or continued. This feature allows to leave outer loop from inner loop. There is no equivalent instruction in C# except unconditional control transfer using <code>goto</code>.</p>
<h1 id="foreach-loop">foreach Loop</h1>
<p><code>foreach</code> statement may accept any expression of type implementing <code>System.Collections.IEnumerable</code> or <code>System.Collections.Generic.IEnumerable&lt;T&gt;</code> interface, or having public instance parameterless method <code>GetEnumerator()</code> which return type has the public instance property <code>Current</code> and public instance parameterless method <code>MoveNext()</code>.</p>
<pre><code class="lang-csharp">using System;
using DotNext.Metaprogramming;

LambdaBuilder&lt;Action&lt;string&gt;&gt;.Build(fun =&gt; 
{
    fun.ForEach(fun.Parameters[0], loop =&gt;
    {
        loop.Call(typeof(Console).GetMethod(nameof(Console.WriteLine), new[]{ typeof(char) }), loop.Element);
    });
});

//generated code is

new Action&lt;string&gt;(str =&gt; 
{
    foreach(char ch in str)
        Console.WriteLine(ch);
});
</code></pre>
<p><code>Element</code> property of the loop statement builder provides access to loop variable.</p>
<h1 id="while-loop">while Loop</h1>
<p><code>while</code> loop statement is supported in two forms: <code>while-do</code> or <code>do-while</code>. Both forms are representing regular <code>while</code> loop existing in most popular languages such as C#, C++ and C.</p>
<pre><code class="lang-csharp">using System;
using DotNext.Metaprogramming;

LambdaBuilder&lt;Fun&lt;long, long&gt;&gt;(fun =&gt; 
{
    UniversalExpression arg = fun.Parameters[0];
    fun.Assign(fun.Result, 1L);  //result = 1L;
    fun.While(arg &gt; 1L, whileBlock =&gt; {
        whileBlock.Assign(fun.Result, arg-- * fun.Result);  //result *= arg--;
    });
});

//generated code is

new Func&lt;long, long&gt;(arg =&gt; 
{
    var result = 1L;
    while(arg &gt; 1L)
        result *= arg--;
    return result;
});
</code></pre>
<p><code>do-while</code> loop can be constructed using <code>DoWhile</code> method.</p>
<h1 id="for-loop">for Loop</h1>
<p><code>for</code> loop implementation in Metaprogramming library has many similarities with implementation in other C-like languages with one exception: <em>increment</em> (or <em>post iteration</em>) statement is optional, has access to the local variables declared inside of the loop and can be a compount statement. This statement is separated from main loop body with a special method call <code>StartIteratorBlock</code>.</p>
<pre><code class="lang-csharp">using System;
using DotNext.Metaprogramming;

LambdaBuilder&lt;Fun&lt;long, long&gt;&gt;(fun =&gt; 
{
    fun.Assign(fun.Result, 1L);  //result = 1L;
    fun.For(fun.Parameters[0], i =&gt; i &gt; 1L, loop =&gt; 
    {
        loop.Assign(fun.Result, i * fun.Result);    //result *= i;
        loop.StartIteratorBlock();
        loop.PostDecrementAssign(loop.LoopVar);  //i--
    });
});

//generated code is

new Func&lt;long, long&gt;(arg =&gt; 
{
    var result = 1L;
    for(var i = arg; i &gt; 1L; i--)
        result *= i;
    return result;
});
</code></pre>
<p>Any call of code generation methods after <code>StartIteratorBlock</code> will be interpreted as <em>post iteration</em> statement. Therefore, this statement is not limited to the simple expression. If method <code>StartIteratorBlock</code> is not used then <code>for</code> loop will be similar to <code>while</code> loop but with implicitly declared loop variable.</p>
<h1 id="plain-loop">Plain Loop</h1>
<p>Plain loop is similar to <code>while(true)</code> loop and doesn't have built-in loop control tools. Developer need to control loop execution by calling <code>Continue()</code> and <code>Break</code> manually.</p>
<pre><code class="lang-csharp">using System;
using DotNext.Metaprogramming;

LambdaBuilder&lt;Fun&lt;long, long&gt;&gt;(fun =&gt; 
{
    UniversalExpression arg = fun.Parameters[0];
    fun.Assign(fun.Result, 1L);  //result = 1L;
    fun.Loop(loopBlock =&gt; 
    {
        loopBlock.If(arg &gt; 1L)
            .Then(thenBlock =&gt; thenBlock.Assign(fun.Result, arg-- * fun.Result))
            .Else(elseBlock =&gt; elseBlock.Break(loopBlock))  //break;
            .End();
    });
});

//generated code is
new Func&lt;long, long&gt;(arg =&gt; 
{
    var result = 1L;
    while(true)
        if(arg &gt; 1L)
            result *= arg--;
        else
            break;
    return true;
});
</code></pre>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/sakno/DotNext/blob/gh-pages/docs/features/metaprogramming/loop.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
